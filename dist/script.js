let books = [
		{
			"name": "დაბ",
			"synonyms": [
				"Gen"
			],
			"numChapters": 50
		},
		{
			"name": "გამ",
			"synonyms": [
				"Exod"
			],
			"numChapters": 40
		},
		{
			"name": "ლევ",
			"synonyms": [
				"Lev"
			],
			"numChapters": 27
		},
		{
			"name": "რიცხ",
			"synonyms": [
				"Num"
			],
			"numChapters": 36
		},
		{
			"name": "რჯლ",
			"synonyms": [
				"Deut"
			],
			"numChapters": 34
		},
		{
			"name": "იესო",
			"synonyms": [
				"Josh"
			],
			"numChapters": 24
		},
		{
			"name": "მსაჯ",
			"synonyms": [
				"Judg"
			],
			"numChapters": 21
		},
		{
			"name": "რუთ",
			"synonyms": [
				"Ruth"
			],
			"numChapters": 4
		},
		{
			"name": "1მეფ",
			"synonyms": [
				"1Sam"
			],
			"numChapters": 31
		},
		{
			"name": "2მეფ",
			"synonyms": [
				"2Sam"
			],
			"numChapters": 24
		},
		{
			"name": "3მეფ",
			"synonyms": [
				"1Kgs"
			],
			"numChapters": 22
		},
		{
			"name": "4მეფ",
			"synonyms": [
				"2Kgs"
			],
			"numChapters": 25
		},
		{
			"name": "1ნეშტ",
			"synonyms": [
				"1Chr"
			],
			"numChapters": 29
		},
		{
			"name": "2ნეშტ",
			"synonyms": [
				"2Chr"
			],
			"numChapters": 36
		},
		{
			"name": "ეზრ",
			"synonyms": [
				"Ezra"
			],
			"numChapters": 10
		},
		{
			"name": "ნეემ",
			"synonyms": [
				"Neh"
			],
			"numChapters": 13
		},
		{
			"name": "ესთ",
			"synonyms": [
				"Esth"
			],
			"numChapters": 10
		},
		{
			"name": "იობ",
			"synonyms": [
				"Job"
			],
			"numChapters": 42
		},
		{
			"name": "ფსალმ",
			"synonyms": [
				"Ps"
			],
			"numChapters": 150
		},
		{
			"name": "იგავ",
			"synonyms": [
				"Prov"
			],
			"numChapters": 31
		},
		{
			"name": "ეკლ",
			"synonyms": [
				"Eccl"
			],
			"numChapters": 12
		},
		{
			"name": "ქებ",
			"synonyms": [
				"Song"
			],
			"numChapters": 8
		},
		{
			"name": "ეს",
			"synonyms": [
				"Isa"
			],
			"numChapters": 66
		},
		{
			"name": "იერ",
			"synonyms": [
				"Jer"
			],
			"numChapters": 52
		},
		{
			"name": "გოდ",
			"synonyms": [
				"Lam"
			],
			"numChapters": 5
		},
		{
			"name": "ეზეკ",
			"synonyms": [
				"Ezek"
			],
			"numChapters": 48
		},
		{
			"name": "დან",
			"synonyms": [
				"Dan"
			],
			"numChapters": 12
		},
		{
			"name": "ოს",
			"synonyms": [
				"Hos"
			],
			"numChapters": 14
		},
		{
			"name": "იოელ",
			"synonyms": [
				"Joel"
			],
			"numChapters": 4
		},
		{
			"name": "ამოს",
			"synonyms": [
				"Amos"
			],
			"numChapters": 9
		},
		{
			"name": "აბდ",
			"synonyms": [
				"Obad"
			],
			"numChapters": 1
		},
		{
			"name": "იონ",
			"synonyms": [
				"Jonah"
			],
			"numChapters": 4
		},
		{
			"name": "მიქ",
			"synonyms": [
				"Mic"
			],
			"numChapters": 7
		},
		{
			"name": "ნაუმ",
			"synonyms": [
				"Nah"
			],
			"numChapters": 3
		},
		{
			"name": "აბაკ",
			"synonyms": [
				"Hab"
			],
			"numChapters": 3
		},
		{
			"name": "სოფ",
			"synonyms": [
				"Zeph"
			],
			"numChapters": 3
		},
		{
			"name": "ანგ",
			"synonyms": [
				"Hag"
			],
			"numChapters": 2
		},
		{
			"name": "ზაქ",
			"synonyms": [
				"Zech"
			],
			"numChapters": 14
		},
		{
			"name": "მალ",
			"synonyms": [
				"Mal"
			],
			"numChapters": 3
		},
		{
			"name": "მათ",
			"synonyms": [
				"Matt"
			],
			"numChapters": 28
		},
		{
			"name": "მარკ",
			"synonyms": [
				"Mark"
			],
			"numChapters": 16
		},
		{
			"name": "ლუკ",
			"synonyms": [
				"Luke"
			],
			"numChapters": 24
		},
		{
			"name": "იოან",
			"synonyms": [
				"John"
			],
			"numChapters": 21
		},
		{
			"name": "საქმე",
			"synonyms": [
				"Acts"
			],
			"numChapters": 28
		},
		{
			"name": "იაკ",
			"synonyms": [
				"Jas"
			],
			"numChapters": 5
		},
		{
			"name": "1პეტრ",
			"synonyms": [
				"1Pet"
			],
			"numChapters": 5
		},
		{
			"name": "2პეტრ",
			"synonyms": [
				"2Pet"
			],
			"numChapters": 3
		},
		{
			"name": "1იოან",
			"synonyms": [
				"1John"
			],
			"numChapters": 5
		},
		{
			"name": "2იოან",
			"synonyms": [
				"2John"
			],
			"numChapters": 1
		},
		{
			"name": "3იოან",
			"synonyms": [
				"3John"
			],
			"numChapters": 1
		},
		{
			"name": "იუდ",
			"synonyms": [
				"Jude"
			],
			"numChapters": 1
		},
		{
			"name": "რომ",
			"synonyms": [
				"Rom"
			],
			"numChapters": 16
		},
		{
			"name": "1კორ",
			"synonyms": [
				"1Cor"
			],
			"numChapters": 16
		},
		{
			"name": "2კორ",
			"synonyms": [
				"2Cor"
			],
			"numChapters": 13
		},
		{
			"name": "გალ",
			"synonyms": [
				"Gal"
			],
			"numChapters": 6
		},
		{
			"name": "ეფეს",
			"synonyms": [
				"Eph"
			],
			"numChapters": 6
		},
		{
			"name": "ფილიპ",
			"synonyms": [
				"Phil"
			],
			"numChapters": 4
		},
		{
			"name": "კოლ",
			"synonyms": [
				"Col"
			],
			"numChapters": 4
		},
		{
			"name": "1თეს",
			"synonyms": [
				"1Thess"
			],
			"numChapters": 5
		},
		{
			"name": "2თეს",
			"synonyms": [
				"2Thess"
			],
			"numChapters": 3
		},
		{
			"name": "1ტიმ",
			"synonyms": [
				"1Tim"
			],
			"numChapters": 6
		},
		{
			"name": "2ტიმ",
			"synonyms": [
				"2Tim"
			],
			"numChapters": 4
		},
		{
			"name": "ტიტ",
			"synonyms": [
				"Titus"
			],
			"numChapters": 3
		},
		{
			"name": "ფილ",
			"synonyms": [
				"Phlm"
			],
			"numChapters": 1
		},
		{
			"name": "ებრ",
			"synonyms": [
				"Heb"
			],
			"numChapters": 13
		},
		{
			"name": "გამოცხ",
			"synonyms": [
				"Rev"
			],
			"numChapters": 22
		}
	]

// https://davidchincharashvii.pythonanywhere.com/api/ka/geo/1/1/1/8
function bibleBookToID(bookName) {
  for (let i = 0; i < books.length; i++) {
      if (books[i].name === bookName || books[i].synonyms.includes(bookName)) {
          return i + 1; // Returns the index + 1 as book ID
      }
  }
  return "Invalid Book Name";
}

function parseBibleReference(reference = "Gen 1:1-1") {
  let book_id = 1, chapter_num = 1, start_verse_num = 1, end_verse_num = 1;

  if (reference.includes(" ")) {
      const parts = reference.split(" ");
      book_id = bibleBookToID(parts[0]);

      if (parts[1].includes(":")) {
          const chapterAndVerse = parts[1].split(":");
          chapter_num = parseInt(chapterAndVerse[0]);

          if (chapterAndVerse[1].includes("-")) {
              const verses = chapterAndVerse[1].split("-");
              start_verse_num = parseInt(verses[0]);
              end_verse_num = parseInt(verses[1]);
          } else {
              start_verse_num = end_verse_num = parseInt(chapterAndVerse[1]);
          }
      }
  }

  return { book_id, chapter_num, start_verse_num, end_verse_num };
}

let search_input = document.querySelector("input");
search_input.addEventListener("keyup", function () {
  let parsedData = parseBibleReference(search_input.value);
  parse(parsedData);
});

let base_url = "https://davidchincharashvii.pythonanywhere.com/api";
let lang = "ka";
let version = "geo";

function parse({ book_id, chapter_num, start_verse_num, end_verse_num }) {
  let url = `${base_url}/${lang}/${version}/${book_id}/${chapter_num}/${start_verse_num}/${end_verse_num}`;
  console.log(url);

  axios.get(url)
    .then(function (response) {
      console.log(response.data);
      let title = `${response.data.book} ${response.data.chapter}`;
      let verses = response.data.verses;
      show(title, verses);
    })
    .catch(function (error) {
      console.log(error);
    });
}

function show(title, verses) {
  let result = document.querySelector(".result");
  let html = `<div class="title">${title}</div>`;
  verses.forEach(verse => {
    html += `<div class="verse">${verse}</div>`;
  });
  result.innerHTML = html;
}

function showLoading() {
  let result = document.querySelector(".result");
  let html = `<div class="loading">Loading...</div>`;
  result.innerHTML = html;
}

function showError() {
  let result = document.querySelector(".result");
  let html = `<div class="error">Error</div>`;
  result.innerHTML = html;
}

function showNotFound() {
  let result = document.querySelector(".result");
  let html = `<div class="not-found">Not Found</div>`;
  result.innerHTML = html;
}

function appendBookList() {
  let bookList = document.querySelector(".book-list");
  let html = "";
  for (let book in books) {
    html += `<a class="book" data-id="${books[book]}">${book}</a>`;
  }
  bookList.innerHTML = html;
}

appendBookList();